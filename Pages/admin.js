import { useEffect, useState } from 'react';
import { db } from '@/lib/firebase';
import { collection, query, where, orderBy, onSnapshot, doc, updateDoc } from 'firebase/firestore';
export default function Admin(){ const [pending,setPending]=useState([]); useEffect(()=>{ const q = query(collection(db,'payments'), where('status','==','pending'), orderBy('createdAt','desc')); return onSnapshot(q,s=> setPending(s.docs.map(d=>({id:d.id,...d.data()})))); },[]); const approve=async(item)=>{ await updateDoc(doc(db,'payments',item.id),{status:'approved'}); alert('approved'); }; const reject=async(it)=>{ await updateDoc(doc(db,'payments',it.id),{status:'rejected'}); }; return (<div className='py-8'><h2 className='text-2xl mb-4'>Admin</h2><div className='card'>{pending.map(p=> (<div key={p.id} className='border-b border-slate-700 py-2'><div className='small'>{p.userId} - {p.amount} - {p.type}</div><div style={{marginTop:6}}><button className='btn btn-primary' onClick={()=>approve(p)}>موافقة</button>{' '}<button className='btn' onClick={()=>reject(p)}>رفض</button></div></div>))}</div></div>); }
